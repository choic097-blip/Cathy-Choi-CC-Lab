<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Project 5 – Optical Illusion – Cathy Choi</title>

  <!-- 공통 스타일 -->
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Noto+Sans+KR:wght@300;400;700&display=swap" rel="stylesheet">

  <!-- p5.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.11.1/p5.js"></script>

  <style>
    #sketch-container {
      margin: 40px 0;
      text-align: center;
    }

    canvas {
      display: block;
      margin: 0 auto;
      border-radius: 12px;
    }

    /* snap 버튼 정리 */
    button {
      margin-top: 15px;
      padding: 8px 16px;
      font-size: 0.95rem;
      border-radius: 20px;
      border: 1px solid #111;
      background: white;
      cursor: pointer;
    }

    button:hover {
      background: #111;
      color: white;
    }
  </style>
</head>

<body>

  <!-- FIXED NAV (통일) -->
  <header class="fixed-nav">
    <div class="nav-left">©Cathy Choi</div>

    <nav class="nav-center">
      <a href="index.html">Main</a>
      <a href="project_index.html">Projects</a>
      <a href="extra.html">Extra</a>
    </nav>

    <div class="nav-right">
      <a href="#">Contact ↗</a>
    </div>
  </header>

  <!-- 본문 -->
  <div class="page-container">

    <h1>Optical Illusion</h1>

    <p class="page-description">
      A webcam-based p5.js experiment that transforms a captured image into a vibrant,
      abstract pattern based on brightness.
    </p>

    <!-- 캔버스 -->
    <div id="sketch-container"></div>

    <h2>Description</h2>
    <p>
      This project captures a live webcam image and converts it into a colorful optical
      illusion. Brightness values are translated into size and hue, creating a dynamic,
      pixel-based abstraction of the captured moment.
    </p>

  </div>

  <!-- ========================= -->
  <!-- p5.js SKETCH (원본 그대로) -->
  <!-- ========================= -->
  <script>
    let video;
    let snapped = false;
    let img;

    function setup() {
      const c = createCanvas(600, 600);
      c.parent("sketch-container");

      colorMode(HSB, 360, 100, 100);
      video = createCapture(VIDEO);
      video.size(600, 600);
      video.hide();

      let snapButton = createButton("snap");
      snapButton.parent("sketch-container");
      snapButton.mouseClicked(takeSnap);

      noStroke();
    }

    function takeSnap() {
      if (!snapped) {
        image(video, 0, 0, width, height);
        img = video.get();
        snapped = true;
        video.remove();
        makeGrayscale(img);
      }
    }

    function draw() {
      if (snapped && img) {
        background(0);
        drawPattern(img);
        noLoop();
      }
    }

    function makeGrayscale(srcImg) {
      srcImg.loadPixels();
      for (let i = 0; i < srcImg.pixels.length; i += 4) {
        let r = srcImg.pixels[i];
        let g = srcImg.pixels[i + 1];
        let b = srcImg.pixels[i + 2];
        let avg = (r + g + b) / 3;
        srcImg.pixels[i] = avg;
        srcImg.pixels[i + 1] = avg;
        srcImg.pixels[i + 2] = avg;
      }
      srcImg.updatePixels();
    }

    let size, hue;

    function drawPattern(srcImg) {
      let step = 20;
      srcImg.loadPixels();

      for (let y = 0; y < height; y += step) {
        for (let x = 0; x < width; x += step) {
          let idx = 4 * (x + y * width);
          let bright = srcImg.pixels[idx];

          if (bright > 200) {
            size = step * 0.7;
            hue = 30;
          } else if (bright > 150) {
            size = step * 0.6;
            hue = 0;
          } else if (bright > 100) {
            size = step * 0.5;
            hue = 120;
          } else if (bright > 50) {
            size = step * 0.4;
            hue = 200;
          } else {
            size = step * 0.3;
            hue = 250;
          }

          fill(hue, 80, 100);
          ellipse(x, y, size);
        }
      }
    }
  </script>

</body>
</html>
